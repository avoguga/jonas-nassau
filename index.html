<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>Corrida RVSaúde</title>
  <link rel="icon" type="image/webp" href="logo.webp">
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <style>
    body {
      margin: 0;
      overflow: hidden;
    }
    #play-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(10,10,15,0.97), rgba(15,20,35,0.97));
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      cursor: pointer;
      backdrop-filter: blur(8px);
    }
    #play-overlay img {
      width: 600px;
      max-width: 80%;
      height: auto;
      margin-bottom: 40px;
      filter: drop-shadow(0 10px 40px rgba(0,217,255,0.3));
      animation: logoFloat 3s ease-in-out infinite;
    }
    @keyframes logoFloat {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-15px); }
    }
    #play-overlay h1 {
      color: #00D9FF;
      font-size: 56px;
      margin-bottom: 30px;
      font-family: 'Segoe UI', 'Arial', sans-serif;
      font-weight: 700;
      text-shadow: 0 0 30px rgba(0,217,255,0.4);
      letter-spacing: 4px;
      animation: titlePulse 3s ease-in-out infinite;
    }
    @keyframes titlePulse {
      0%, 100% { opacity: 0.95; }
      50% { opacity: 1; text-shadow: 0 0 40px rgba(0,217,255,0.6); }
    }
    #play-overlay button {
      padding: 24px 60px;
      font-size: 28px;
      background: linear-gradient(135deg, #00D9FF, #00A3CC);
      color: #000;
      border: 2px solid rgba(0,217,255,0.3);
      border-radius: 50px;
      cursor: pointer;
      font-weight: 600;
      box-shadow: 0 10px 35px rgba(0, 217, 255, 0.5);
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      font-family: 'Segoe UI', 'Arial', sans-serif;
      letter-spacing: 2px;
      text-transform: uppercase;
      position: relative;
      overflow: hidden;
    }
    #play-overlay button::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255,255,255,0.3);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }
    #play-overlay button:hover::before {
      width: 300px;
      height: 300px;
    }
    #play-overlay button:hover {
      transform: scale(1.08) translateY(-4px);
      box-shadow: 0 15px 50px rgba(0, 217, 255, 0.7);
      border-color: rgba(0,217,255,0.6);
    }
    #play-overlay button:active {
      transform: scale(1.02) translateY(-2px);
    }
  </style>
</head>
<body>
  <!-- Overlay de Play -->
  <div id="play-overlay">
    <img src="logo.webp" alt="VSAÚDE Logo">
    <h1>CORRIDA RVSAÚDE</h1>
    <button id="start-button">▶ INICIAR EXPERIÊNCIA</button>
  </div>

  <a-scene>
    <!-- Assets -->
    <a-assets>
      <!-- Vídeo 360 Equirectangular - jfk.webm -->
      <video id="video360"
             playsinline
             webkit-playsinline
             loop="true"
             muted
             preload="auto"
             crossorigin="anonymous">
        <source src="jfk.webm" type="video/webm">
      </video>
      <!-- Logo VSAÚDE -->
      <img id="logo" src="logo.webp" crossorigin="anonymous">
    </a-assets>

    <!-- Vídeo 360 como videosphere -->
    <a-videosphere src="#video360" rotation="0 0 0"></a-videosphere>

    <!-- Câmera com controles -->
    <a-entity id="camera-rig" position="0 0 0" rotation="0 180 0">
      <a-camera id="main-camera" look-controls wasd-controls="acceleration: 20">
        <a-cursor color="#00FFFF"></a-cursor>

        <!-- UI CIRCULAR ESTILO XBOX - Layout Y-X-B-A -->
        <a-entity id="hud" position="-1 -1.4 -3">

          <!-- VELOCIDADE - Topo (Y - Amarelo) -->
          <a-entity position="0 0.5 0">
            <!-- Fundo circular escuro -->
            <a-circle color="#0a0a0a" opacity="0.7" radius="0.24" segments="48"></a-circle>

            <!-- Borda circular amarela -->
            <a-ring color="#FFD700" opacity="0.85" radius-inner="0.23" radius-outer="0.25"
                    segments-theta="48" position="0 0 0.001"></a-ring>

            <!-- Label -->
            <a-text value="VELOCIDADE" color="#FFD700" width="0.7" align="center"
                    position="0 0.1 0.01" shader="flat" letter-spacing="1"></a-text>

            <!-- Valor -->
            <a-text id="speed-value" value="0" color="#FFFFFF" width="2" align="center"
                    position="0 -0.02 0.01" shader="flat" font="roboto"></a-text>

            <!-- Unidade -->
            <a-text value="km/h" color="#CCAA55" width="0.6" align="center" opacity="0.85"
                    position="0 -0.12 0.01" shader="flat"></a-text>
          </a-entity>

          <!-- DISTÂNCIA - Esquerda (X - Azul) -->
          <a-entity position="-0.5 0 0">
            <!-- Fundo circular -->
            <a-circle color="#0a0a0a" opacity="0.7" radius="0.24" segments="48"></a-circle>

            <!-- Borda circular azul -->
            <a-ring color="#00BFFF" opacity="0.85" radius-inner="0.23" radius-outer="0.25"
                    segments-theta="48" position="0 0 0.001"></a-ring>

            <!-- Label -->
            <a-text value="DISTÂNCIA" color="#00BFFF" width="0.7" align="center"
                    position="0 0.1 0.01" shader="flat" letter-spacing="1"></a-text>

            <!-- Valor -->
            <a-text id="distance-value" value="0" color="#FFFFFF" width="2" align="center"
                    position="0 -0.02 0.01" shader="flat" font="roboto"></a-text>

            <!-- Unidade -->
            <a-text value="metros" color="#5599BB" width="0.6" align="center" opacity="0.75"
                    position="0 -0.12 0.01" shader="flat"></a-text>
          </a-entity>

          <!-- TEMPO - Direita (B - Vermelho) -->
          <a-entity position="0.5 0 0">
            <!-- Fundo circular -->
            <a-circle color="#0a0a0a" opacity="0.7" radius="0.24" segments="48"></a-circle>

            <!-- Borda circular vermelha -->
            <a-ring color="#FF4444" opacity="0.85" radius-inner="0.23" radius-outer="0.25"
                    segments-theta="48" position="0 0 0.001"></a-ring>

            <!-- Label -->
            <a-text value="TEMPO" color="#FF4444" width="0.7" align="center"
                    position="0 0.1 0.01" shader="flat" letter-spacing="1"></a-text>

            <!-- Valor -->
            <a-text id="time-value" value="00:00" color="#FFFFFF" width="1.8" align="center"
                    position="0 -0.02 0.01" shader="flat" font="roboto"></a-text>

            <!-- Unidade -->
            <a-text value="min:seg" color="#BB5555" width="0.6" align="center" opacity="0.75"
                    position="0 -0.12 0.01" shader="flat"></a-text>
          </a-entity>

          <!-- PASSOS - Embaixo (A - Verde) -->
          <a-entity position="0 -0.5 0">
            <!-- Fundo circular -->
            <a-circle color="#0a0a0a" opacity="0.7" radius="0.24" segments="48"></a-circle>

            <!-- Borda circular verde -->
            <a-ring color="#00FF00" opacity="0.85" radius-inner="0.23" radius-outer="0.25"
                    segments-theta="48" position="0 0 0.001"></a-ring>

            <!-- Label -->
            <a-text value="PASSOS" color="#00FF00" width="0.7" align="center"
                    position="0 0.1 0.01" shader="flat" letter-spacing="1"></a-text>

            <!-- Valor -->
            <a-text id="steps-value" value="0" color="#FFFFFF" width="2" align="center"
                    position="0 -0.02 0.01" shader="flat" font="roboto"></a-text>

            <!-- Unidade -->
            <a-text value="steps" color="#55BB55" width="0.6" align="center" opacity="0.75"
                    position="0 -0.12 0.01" shader="flat"></a-text>
          </a-entity>

          <!-- Status indicator - círculo pequeno -->
          <a-entity position="-0.75 -0.75 0.01">
            <a-circle color="#00FF00" opacity="0.9" radius="0.018" segments="16"></a-circle>
            <a-ring color="#00FF00" opacity="0.5" radius-inner="0.018" radius-outer="0.025"
                    segments-theta="16" position="0 0 -0.001"></a-ring>
            <a-text value="LIVE" color="#00FF00" width="0.45" align="left" opacity="0.9"
                    position="0.05 -0.008 0" shader="flat" letter-spacing="2"></a-text>
          </a-entity>

        </a-entity>

      </a-camera>
    </a-entity>

    <!-- Luz ambiente -->
    <a-light type="ambient" color="#BBB"></a-light>
  </a-scene>

  <script>
    // Componente de animação da HUD
    AFRAME.registerComponent('hud-animations', {
      init: function() {
        const hud = this.el;

        // Fade-in suave ao carregar
        hud.setAttribute('animation__fadein', {
          property: 'opacity',
          from: 0,
          to: 1,
          dur: 1000,
          easing: 'easeOutQuad'
        });
      }
    });


    // Componente de simulação de corrida
    AFRAME.registerComponent('running-simulator', {
      init: function() {
        this.isRunning = false;
        this.startTime = 0;
        this.elapsedTime = 0;

        // Métricas da corrida
        this.totalDistance = 0;
        this.steps = 0;
        this.currentSpeed = 0;
        this.targetSpeed = 0;

        // Parâmetros da corrida
        this.baseSpeed = 9; // km/h base
        this.maxSpeed = 16; // km/h máximo
        this.minSpeed = 5; // km/h mínimo

        // Referências aos elementos de texto
        this.speedText = document.querySelector('#speed-value');
        this.stepsText = document.querySelector('#steps-value');
        this.distanceText = document.querySelector('#distance-value');
        this.timeText = document.querySelector('#time-value');

        // Para controle de passos
        this.stepTimer = 0;
        this.stepInterval = 0.5; // segundos entre passos na velocidade base

        // Para transições suaves dos valores
        this.displaySpeed = 0;
        this.displayDistance = 0;
      },

      start: function() {
        this.isRunning = true;
        this.startTime = Date.now();
        console.log('Simulação de corrida iniciada!');
      },

      stop: function() {
        this.isRunning = false;
      },

      tick: function(time, deltaTime) {
        if (!this.isRunning) return;

        const deltaSec = deltaTime / 1000;
        this.elapsedTime = (Date.now() - this.startTime) / 1000;

        // Varia a velocidade alvo de forma suave e realística
        // Usa seno para criar variações naturais
        const speedVariation = Math.sin(this.elapsedTime * 0.3) * 3 +
                              Math.sin(this.elapsedTime * 0.7) * 2;
        this.targetSpeed = this.baseSpeed + speedVariation;
        this.targetSpeed = Math.max(this.minSpeed, Math.min(this.maxSpeed, this.targetSpeed));

        // Interpola suavemente para a velocidade alvo
        this.currentSpeed += (this.targetSpeed - this.currentSpeed) * 0.05;

        // Calcula distância percorrida neste frame
        // Velocidade em km/h -> m/s -> metros percorridos
        const distanceThisFrame = (this.currentSpeed / 3.6) * deltaSec;
        this.totalDistance += distanceThisFrame;

        // Calcula passos baseado na velocidade
        // Quanto mais rápido, menos tempo entre passos
        const currentStepInterval = this.stepInterval * (this.baseSpeed / this.currentSpeed);
        this.stepTimer += deltaSec;

        if (this.stepTimer >= currentStepInterval) {
          this.steps++;
          this.stepTimer = 0;
        }

        // Atualiza UI
        this.updateUI();
      },

      updateUI: function() {
        // Transições suaves para valores numéricos
        this.displaySpeed += (this.currentSpeed - this.displaySpeed) * 0.15;
        this.displayDistance += (this.totalDistance - this.displayDistance) * 0.1;

        if (this.speedText) {
          this.speedText.setAttribute('value', Math.round(this.displaySpeed).toString());
        }
        if (this.stepsText) {
          this.stepsText.setAttribute('value', this.steps.toString());
        }
        if (this.distanceText) {
          this.distanceText.setAttribute('value', Math.round(this.displayDistance).toString());
        }
        if (this.timeText) {
          const minutes = Math.floor(this.elapsedTime / 60);
          const seconds = Math.floor(this.elapsedTime % 60);
          const timeStr = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
          this.timeText.setAttribute('value', timeStr);
        }
      }
    });

    // Sistema de controle de vídeo
    AFRAME.registerComponent('video-controls', {
      init: function() {
        const video = document.querySelector('#video360');
        const startButton = document.querySelector('#start-button');
        const playOverlay = document.querySelector('#play-overlay');
        const cameraRig = document.querySelector('#camera-rig');

        // Função para iniciar vídeo e simulação
        const startExperience = () => {
          console.log('Iniciando experiência...');

          // Inicia o vídeo
          video.play().then(() => {
            console.log('Vídeo iniciado com sucesso!');
            playOverlay.style.display = 'none';

            // Inicia a simulação de corrida
            const simulator = cameraRig.components['running-simulator'];
            if (simulator) {
              simulator.start();
            }
          }).catch((error) => {
            console.error('Erro ao iniciar vídeo:', error);
            // Tenta método alternativo do A-Frame
            try {
              const videosphere = document.querySelector('a-videosphere');
              if (videosphere && videosphere.components && videosphere.components.material) {
                const videoElement = videosphere.components.material.material.map.image;
                videoElement.play();
                playOverlay.style.display = 'none';

                // Inicia a simulação de corrida
                const simulator = cameraRig.components['running-simulator'];
                if (simulator) {
                  simulator.start();
                }
              }
            } catch(e) {
              console.error('Método alternativo falhou:', e);
            }
          });
        };

        // Evento do botão
        if (startButton) {
          startButton.addEventListener('click', startExperience);
        }

        // Previne autoplay
        video.pause();
      }
    });

    // Quando a cena carregar
    document.addEventListener('DOMContentLoaded', function() {
      const scene = document.querySelector('a-scene');

      scene.addEventListener('loaded', function() {
        console.log('Cena A-Frame carregada');

        // Adiciona componentes
        const cameraRig = document.querySelector('#camera-rig');
        if (cameraRig) {
          cameraRig.setAttribute('running-simulator', '');
        }

        const sceneEl = document.querySelector('a-scene');
        if (sceneEl) {
          sceneEl.setAttribute('video-controls', '');
        }

        // Adiciona animações à HUD
        const hud = document.querySelector('#hud');
        if (hud) {
          hud.setAttribute('hud-animations', '');
        }
      });
    });
  </script>
</body>
</html>
